---
title: supertest ë¡œ í†µí•© í…ŒìŠ¤íŠ¸ í•˜ê¸°
date: 2025-04-08
categories:
  - Node.js
tags:
  - Node
  - express
  - supertest
---
ì•ˆë…•í•˜ì„¸ìš” ðŸ¸  

supertest ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ í†µí•© í…ŒìŠ¤íŠ¸ í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.  

## supertest
í†µí•©í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¼ìš°íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

## ì„¤ì¹˜ ë°©ë²•

```
npm i -D supertest
```

## ì‚¬ìš© ë°©ë²•
supertest ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ìž‘ì—…ì„ ëª‡ ë‹¨ê³„ë¡œ ìš”ì•½í•˜ìžë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  
1. app.js ì—ì„œ appì„ export
2. app.js ì—ì„œ ì„œë²„ ì‹¤í–‰ ì½”ë“œë¥¼ ë¶„ë¦¬
3. package.json ì—ì„œ start ìŠ¤í¬ë¦½íŠ¸ì˜ ë³€ê²½
4. í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„± ë° í…ŒìŠ¤íŠ¸

### app.js ì—ì„œ appì„ export
ê¸°ì¡´ì— app.js ì—ì„œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì•„ëž˜ì˜ ì½”ë“œë¥¼ ì œê±°í•©ë‹ˆë‹¤.  

```javascript
// ìƒëžµ
app.listen(/*ë‚´ìš© ìƒëžµ*/);
```

ê·¸ë¦¬ê³  ìƒì„±í•œ app ì„ `module.exports` í•©ë‹ˆë‹¤.  
ì˜ˆì‹œ)  

```javascript
// ìƒëžµ
module.exports = app;
```

ì´ë¥¼ í†µí•´ app.js ëŠ” ìžì²´ì ìœ¼ë¡œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒì´ ì•„ë‹ˆê³  ì„œë²„ì˜ ì„¤ì •ì„ ì™„ì„±ë§Œ í•˜ê³  ì´ê²ƒì„ export í•˜ëŠ” ì—­í• ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.  
### app.js ì—ì„œ ì„œë²„ ì‹¤í–‰ ì½”ë“œë¥¼ ë¶„ë¦¬
ì•ž ë‹¨ê³„ë¥¼ í†µí•´ app.js ëŠ” ë” ì´ìƒ ìžì²´ì ìœ¼ë¡œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ì•„ëž˜ì˜ ì½”ë“œê°€ ì œê±°ë˜ì—ˆê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.  

```javascript
app.listen(/*ë‚´ìš© ìƒëžµ*/);
```

ì´ì œ ì‹¤ì œë¡œ ì„œë²„ë¥¼ ì‹œìž‘í•´ì¤„ ì—­í• ì´ í•„ìš”í•©ë‹ˆë‹¤.  
ê·¸ê²ƒì„ ìž„ì˜ì˜ íŒŒì¼ `server.js` ë¡œ ëª…ëª…ì§€ì–´ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.  
server.js ì—ì„œëŠ” app.js ì—ì„œ exportí•œ appì„ ë°›ì•„ì„œ ì„œë²„ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤.  
ì½”ë“œëŠ” ì•„ëž˜ì™€ ê°™ìŠµë‹ˆë‹¤.  

```javascript
const app = require('./app');
app.listen(app.get('port'),()=>{
Â  Â  console.log(app.get('port'),'ë²ˆ í¬íŠ¸ì—ì„œ ëŒ€ê¸° ì¤‘');
})
```


ê¸°ì¡´ì—ëŠ” íŒŒì¼ êµ¬ì¡°ê°€ ì•„ëž˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤.  
- / (root)
	- app.js
	- package.json
	- ê¸°íƒ€ íŒŒì¼ ë° ë””ë ‰í† ë¦¬

ì´ëŸ° íŒŒì¼ êµ¬ì¡°ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤.  
- / (root)
	- app.js
	- server.js
	- package.json
	- ê¸°íƒ€ íŒŒì¼ ë° ë””ë ‰í† ë¦¬

ì—¬ê¸°ì„œ ìƒˆë¡œì´ ì¶”ê°€ëœ `server.js` ë¼ëŠ” íŒŒì¼ì€ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ì—­í• ë§Œì„ ë‹´ë‹¹í•˜ê²Œ ë©ë‹ˆë‹¤.  

### package.json ì—ì„œ start ìŠ¤í¬ë¦½íŠ¸ì˜ ë³€ê²½
ì´ì œ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— ì„œë²„ë¥¼ ì‹œìž‘í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì˜ ë‚´ìš©ë„ ë³€ê²½ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.  
ê¸°ì¡´ package.json íŒŒì¼ì˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ start ëŠ” app.js íŒŒì¼ì„ ì‚¬ìš© í•˜ê³  ìžˆì—ˆìŠµë‹ˆë‹¤.  
ì´ë¥¼ ì‹¤ì œë¡œ ì„œë²„ë¥¼ ì‹œìž‘í•˜ëŠ” `server.js` íŒŒì¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.  

ê¸°ì¡´ : `"start":"nodemon app.js"`  
ë³€ê²½ : `"start":"nodemon server.js"`

### í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„± ë° í…ŒìŠ¤íŠ¸
í…ŒìŠ¤íŠ¸ ì½”ë“œ íŒŒì¼ì˜ ìƒì„± ë°©ë²•ì€ jest ì™€ ë™ì¼í•˜ê²Œ íŒŒì¼ ëª…ì— `.test` í˜¹ì€ `.spec` ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ ìž…ë‹ˆë‹¤.  
ì˜ˆì‹œ)  
- `user.js` ì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ `user.test.js`  

í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸°ì— ì•žì„œ ë‹¤ìŒì˜ 4ê°œì˜ í•¨ìˆ˜ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ ì „/í›„ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
- beforeAll : ë¸”ëŸ­ ë‚´ì˜ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì „ 1íšŒ ë™ìž‘
- beforeEach : ë¸”ëŸ­ ë‚´ì˜ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ì— ì•žì„œ ë™ìž‘
- afterAll : ë¸”ëŸ­ ë‚´ì˜ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ í›„ 1íšŒ ë™ìž‘
- afterEach : ë¸”ëŸ­ ë‚´ì˜ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ í›„ì— ë™ìž‘

ì´í›„ ì‹¤ì œ í…ŒìŠ¤íŠ¸ëŠ” jestì™€ ë™ì¼í•˜ê²Œ ì•„ëž˜ì˜ êµ¬ì„±ì„ ê°€ì§‘ë‹ˆë‹¤.  

```javascript
describe('í…ŒìŠ¤íŠ¸ ê·¸ë£¹',()=>{
	test('í…ŒìŠ¤íŠ¸1',(done)=>{});
	test('í…ŒìŠ¤íŠ¸2',(done)=>{})
})
```

ì—¬ê¸°ì„œ íŠ¹ì´í•œ ë¶€ë¶„ì€ `done` ì´ë¼ëŠ” ì½œë°± í•¨ìˆ˜ì˜ ì¡´ìž¬ìž…ë‹ˆë‹¤.  
ì´ëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë  ë•Œ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŒì„ Jestì— ì•Œë ¤ì£¼ëŠ” í•¨ìˆ˜ ìž…ë‹ˆë‹¤.  

ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¥¼ ìš”ì²­í•˜ëŠ” ê²ƒì€ ì•„ëž˜ì˜ í˜•ì‹ì„ ê°€ì§‘ë‹ˆë‹¤.  

```javascript
const app = require('../app');
const request = require('supertest');
// ìƒëžµ
request(app).post('/test')
.send({/*body íŒŒë¼ë¯¸í„°*/})
.expect({ìƒíƒœì½”ë“œ},done);
```

ì¼ë¶€ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì„¸ì…˜ì„ ìœ ì§€í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìžˆìŠµë‹ˆë‹¤.  
ë¡œê·¸ì¸í•œ ì‚¬ìš©ìžì— ëŒ€í•œ ë¡œì§ì„ í…ŒìŠ¤íŠ¸ í•˜ê¸° ìœ„í•´ì„œê°€ ê·¸ ì˜ˆì‹œìž…ë‹ˆë‹¤.  
ì´ ê²½ìš° `agent()` í•¨ìˆ˜ë¥¼ í†µí•´ ì„¸ì…˜ì„ ìœ ì§€í•˜ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.  

ì•„ëž˜ëŠ” ì˜ˆì‹œìž…ë‹ˆë‹¤.  

```javascript
const app = require('../app');
const request = require('supertest');
// ìƒëžµ
describe('ì„¸ì…˜ ìœ ì§€',()=>{
	const agent = request.agent(app);
	test('ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸',(done)=>{
		agent.post('/login')
		.send({/*ì‚¬ìš©ìžì •ë³´*/})
		.expect(302,done);
	})
	test('ë¡œê·¸ì¸ ì‚¬ìš©ìž í™•ì¸',(done)=>{
		agent.post('/login/test')
		.expect(302,done);
	})
});
```


ì•„ëž˜ëŠ” supertest ì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ë“¤ ìž…ë‹ˆë‹¤.
- beforeAll : ë¸”ëŸ­ ë‚´ì˜ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì „ 1íšŒ ë™ìž‘
- beforeEach : ë¸”ëŸ­ ë‚´ì˜ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ì— ì•žì„œ ë™ìž‘
- afterAll : ë¸”ëŸ­ ë‚´ì˜ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ í›„ 1íšŒ ë™ìž‘
- afterEach : ë¸”ëŸ­ ë‚´ì˜ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ í›„ì— ë™ìž‘
- describe : í…ŒìŠ¤íŠ¸ë¥¼ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ìŒ
- test : ì‹¤ì œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
- send : bodyì— ê°’ ì „ë‹¬
- set : í—¤ë” ì„¤ì •
- query : URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì „ë‹¬
- expect : í…ŒìŠ¤íŠ¸ ê¸°ëŒ€ ê²°ê³¼
- agent(app) : ì„¸ì…˜ ë“±ì„ ìœ ì§€í•˜ë©´ì„œ appì„ ìž¬ì‚¬ìš© ê°€ëŠ¥
- end : ìš”ì²­ì„ ì‹¤ì œë¡œ ì„œë²„ë¡œ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ìŒ

## í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„± ì˜ˆì‹œ

ì•„ëž˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ì˜ˆì‹œ ìž…ë‹ˆë‹¤.

```javascript
const app = require('../app');
const request = require('supertest');
const {sequelize} = require('sequelize');

// ì „ì²´ ì‹œìž‘í•˜ê¸° ì „ 1íšŒ ìˆ˜í–‰
beforeAll(async()=>{
	// í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê¸° ì „ DB ì—°ê²°ì„ ìœ„í•œ ì‹œí€„ë¼ì´ì¦ˆ ì‹±í¬
	// ì´ì „ í…ŒìŠ¤íŠ¸ë¡œ ì¸í•œ ë°ì´í„° ì œê±° í•˜ê¸° ìœ„í•œ force:true
	await sequelize.sync({force:true});
})

describe('í…ŒìŠ¤íŠ¸ ê·¸ë£¹1',()=>{
	test('í…ŒìŠ¤íŠ¸ ë‚´ìš©',(done)=>{
		request(app).post('/test')
		.send({
			id:'id',
			password:'password'
		})
		.expect('Location','/')
		.expect(302,done);
	})
})

describe('ì„¸ì…˜ ìœ ì§€ í…ŒìŠ¤íŠ¸',()=>{
	const agent = request.agnet(app);
	test('ì¿ í‚¤ ìƒì„±',(done)=>{
		agent.post('/cookie')
		.send({
			id:'id'
		})
		.expect('Location','/')
		.expect(302,done)
	});

	test('ì„¸ì…˜ì„ í•„ìš”ë¡œ í•˜ëŠ” í…ŒìŠ¤íŠ¸',(done)=>{
		agent.post('/cookie/test')
		.expect(200,done);
	});
})

afterAll(async()=>{
	await sequelize.close();
})
```
